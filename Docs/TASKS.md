# PF2e Tactical RPG — Task Board (LLM-First)

Status legend: `todo` | `in_progress` | `verify` | `done`

| ID | Priority | Status | Agent Role | Task | DoD |
| --- | --- | --- | --- | --- | --- |
| T-001 | P0 | done | Planner | Define weekly implementation plan for top 3 MVP combat improvements | Task breakdown has scope, risk, and validation commands |
| T-002 | P0 | done | Builder | Add one incremental AI behavior improvement without breaking current melee baseline | AI target selection now prefers same-elevation players but falls back to nearest alive player on any elevation; EditMode coverage added; no turn deadlocks introduced |
| T-003 | P0 | done | Verifier | Validate encounter flow and combat-end UX regressions | Test evidence attached with pass/fail per command |
| T-004 | P1 | done | Builder | Prepare second-scene wiring path for `EncounterFlowPanel.prefab` | Scene wiring documented + smoke validation steps |
| T-005 | P1 | done | Verifier | Audit `TurnManager` action-lock invariants on latest changes | Repro case list + no stuck lock in test run |
| T-006 | P0 | done | Planner | Define scope for AI target-priority upgrade (low HP focus + no-progress bail-out) | Task contract names impacted files, invariants, and validation commands |
| T-007 | P0 | done | Builder | Implement AI target-priority MVP upgrade in `SimpleMeleeAIDecision`/`AITurnController` | Enemy target selection is deterministic and avoids no-progress turn loops |
| T-008 | P1 | done | Verifier | Add deterministic EditMode coverage for AI target-priority and no-progress guards | New tests fail on regressions and pass in CI |
| T-009 | P0 | done | Planner | Lock typed-events migration contract and update memory/roadmap/task docs | Project memory + roadmap + task board reflect typed-only direction and migration sequence |
| T-010 | P0 | done | Builder | Migrate UI/gameplay subscribers from `TurnManager` events to `CombatEventBus` typed channels | `InitiativeBarController`, `MovementZoneVisualizer`, `TargetingController`, and encounter flow UI subscribe via typed bus |
| T-011 | P0 | done | Builder | Deprecate and remove legacy `OnCombatEnded` path + `TurnManagerLogForwarder` | No runtime references to legacy combat-end event or legacy log forwarder remain |
| T-012 | P1 | done | Builder | Align scene validator and editor autofix with typed-only event path | Validator/autofix stop requiring deprecated forwarder and cover typed forwarders/components |
| T-013 | P1 | done | Verifier | Add/refresh regression checks for typed event flow and combat-end UX | EditMode/PlayMode checks prove encounter end + turn UI still react correctly after migration |
| T-014 | P1 | done | Builder | Remove temporary `AITurnController` legacy TurnManager fallback and enforce strict bus wiring | `AITurnController` listens only to typed bus events; scene wiring/validator/autofix updated; tests stay green |
| T-015 | P1 | done | Verifier | Add PlayMode regression for blocked enemy no-progress handling | New PlayMode scenario proves blocked enemy turn exits quickly and does not leave `TurnManager` in `ExecutingAction` |
| T-016 | P1 | done | Builder | Add sticky target lock per enemy turn (reacquire only when target invalid) | Enemy AI keeps current target through the turn, only reacquires on invalid target; deterministic EditMode tests cover lock behavior |
| T-017 | P1 | done | Verifier | Add PlayMode E2E regression for sticky target lock under dynamic retarget pressure | New PlayMode scenario proves enemy keeps locked target for the same turn even when another player becomes a better candidate after first strike |
| T-018 | P0 | done | Builder | Complete typed turn-event migration by removing runtime `TurnManager` subscribers | `TurnManager` now publishes typed turn events directly to `CombatEventBus`; `TurnManagerTypedForwarder` is deprecated/disabled and validator-autofix enforces `TurnManager.eventBus` wiring |
| T-019 | P0 | done | Builder | Remove deprecated turn forwarder components and compatibility stubs | Deprecated `TurnManagerTypedForwarder`/`TurnManagerLogForwarder` components removed from authored scenes; stub scripts deleted; validator/autofix no longer depends on them |
| T-020 | P1 | done | Verifier | Add EditMode proof that `TurnManager` publishes typed lifecycle events directly to `CombatEventBus` | New EditMode test validates direct bus publication for combat start / initiative / round / turn / actions lifecycle without adapter components |
| T-021 | P1 | done | Verifier | Add EditMode proof for `EndTurn` direct typed publish path | New EditMode test validates direct `TurnEnded` + `ConditionsTicked` publication from `TurnManager.EndTurn` to `CombatEventBus` |
| T-022 | P1 | done | Verifier | Add PlayMode event-order regression for `EndTurn` lifecycle | New PlayMode test validates typed event order `ConditionsTicked -> TurnEnded -> TurnStarted(next)` during real scene flow |
| T-023 | P1 | done | Verifier | Add PlayMode initiative payload integrity regression on typed bus | New PlayMode test validates `OnInitiativeRolledTyped` payload count/uniqueness/team composition/sort order under real scene flow |
| T-024 | P1 | done | Verifier | Add PlayMode consistency regression for combat-end payload and panel text mapping | New PlayMode test validates payload-to-UI text consistency across live victory (`CheckVictory`) and manual abort (`EndCombat`) flows |
| T-025 | P1 | done | Verifier | Add explicit PlayMode defeat consistency contract-case for combat-end payload mapping | New PlayMode test validates `EncounterResult.Defeat` maps to correct panel title/subtitle in live `CheckVictory` flow |
| T-026 | P1 | done | Builder | Extract encounter-end text mapping to pure helper + cover with EditMode tests | `EncounterEndTextMap` is runtime source-of-truth for `EncounterResult -> title/subtitle`; EditMode test covers Victory/Defeat/Aborted/Unknown mappings |
| T-027 | P1 | done | Builder | Extract combat-end log message mapping to pure helper + cover with EditMode tests | `EncounterEndLogMessageMap` is source-of-truth for `EncounterResult -> TurnLogForwarder` message mapping; EditMode tests cover Victory/Defeat/Aborted/Unknown |
| T-028 | P1 | done | Builder | Introduce AI decision policy seam (`IAIDecisionPolicy`) with behavior parity | `AITurnController` keeps orchestration + sticky lock; decision selection routes through `SimpleMeleeDecisionPolicy`; EditMode policy tests added; no gameplay behavior drift |
| T-029 | P0 | done | Builder | Introduce `ConditionService` as single mutation entrypoint with caller-owned delta buffers | `TurnManager` and `StandAction` mutate conditions via `ConditionService`; start-turn stunned removal now emits typed `ConditionChanged`; new EditMode service/event tests pass |
| T-030 | P1 | done | Builder | Unify condition tick payload to `ConditionDelta` and deprecate presentation-domain bridge | `ConditionsTickedEvent` now carries `ConditionDelta`; `ConditionTickForwarder` is inert/deprecated and validator warns if present |
| T-031 | P1 | done | Builder | Tighten condition guardrails by removing legacy direct condition mutations | Remaining legacy callers migrated to `ConditionService`; `EntityData.AddCondition/RemoveCondition` scope tightened to `internal` |
| T-032 | P0 | done | Builder | Implement Phase 18.5 condition semantics (`Value + RemainingRounds`) in `ConditionService` | End-turn tick now applies independent value auto-decay + duration countdown; `ConditionDelta` includes value/duration old/new payload; EditMode tests cover duration-only, mixed, and removal cases |
| T-033 | P1 | done | Builder | Enforce `one public type per file` for encounter-end log mapping | `EncounterEndLogMessageMap` moved to `Assets/Scripts/Presentation/EncounterEndLogMessageMap.cs`; `TurnLogForwarder.cs` now contains only `TurnLogForwarder` |
| T-034 | P0 | done | Builder | Implement Phase 18.6 strict snapshot-based DerivedStatsCache in `EntityData` | `EffectiveAC` and `ConditionPenaltyToAttack` now use snapshot/fingerprint validation (`Dexterity`, `Level`, armor state, conditions including `RemainingRounds`) to avoid stale reads under direct field mutations; EditMode coverage added |
| T-035 | P0 | done | Builder | Implement Phase 18.7 implied/stacking helpers in `ConditionRules` and route derived stats through them | `ConditionRules` now computes attack/AC penalties with status max + implied prone/off-guard logic; `EntityData` derived cache uses these helpers; new EditMode tests cover stacking contracts |
| T-036 | P1 | done | Builder | Add PlayMode regression for duration-based condition lifecycle and log consistency | Real scene turn-flow now has coverage for `DurationChanged` (round decrement) and finite-duration removal events for `Slowed`, including `ConditionsTicked` payload and condition-log output consistency |
| T-037 | P1 | done | Builder | Add PlayMode live-strike regression for status/circumstance stacking semantics | Live strike payload now has regression coverage for attack bonus using max status penalty and target DC using max status + single circumstance (`OffGuard || Prone` no double count) |
| T-038 | P1 | done | Builder | Migrate legacy EditMode turn-condition tests from `EntityData.StartTurn/EndTurn` to `ConditionService` tick APIs | `EntityDataTests` now uses `ConditionService.TickStartTurn/TickEndTurn` for turn-condition assertions; legacy `StartTurn/EndTurn` remain compatibility-only and obsolete-tagged |
| T-039 | P0 | done | Builder | Implement Phase 19.1/19.2 shield equipment + `Raise Shield` action | `ShieldDefinition/ShieldInstance` added, `EntityData` supports equipped shield + AC bonus when raised, `RaiseShieldAction` spends 1 action and publishes typed `ShieldRaisedEvent` |
| T-040 | P0 | done | Builder | Implement Phase 19.3/19.4 strike phase chain + reaction eligibility/rules foundation | `StrikeAction` split into phased APIs with `StrikePreDamageEvent`; `ReactionService` + `ShieldBlockRules` are pure/deterministic and covered by EditMode tests |
| T-041 | P0 | done | Builder | Implement Phase 19.5a/19.5b Shield Block reaction execution + modal prompt UX | `ShieldBlockAction` + typed `ShieldBlockResolvedEvent`, `ModalReactionPolicy`, async enemy reaction window in `AITurnController`, timeout/disable-safe prompt handling, and player sync strike path compatibility all verified by EditMode/PlayMode tests |
| T-042 | P1 | done | Builder | Implement Phase 19.6 scene wiring + validator/autofix + Shield Block combat log integration | `SampleScene` now includes shield demo wiring (`FighterShield`, `ReactionPromptController`, `RaiseShieldAction`, `ShieldBlockAction`), validator/autofix covers new refs/components, and `StrikeLogForwarder` logs `ShieldBlockResolvedEvent` |
| T-043 | P0 | done | Builder | Implement Phase 21 generic check system + `TripAction` | `SkillType/SaveType`, `SkillRules`, `CheckResolver`, `SkillCheckResolvedEvent`, `TripAction`, executor wiring, and EditMode coverage added; `Trip` applies `Prone` and crit `1d6` damage |
| T-044 | P0 | done | Builder | Implement `DemoralizeAction` (`Intimidation` vs `Will DC`) with tests | `DemoralizeAction` + `PlayerActionExecutor.TryExecuteDemoralize` added; `Frightened` outcomes, no-MAP semantics, range boundary tests, and lock rollback coverage are green |
| T-045 | P0 | done | Builder | Implement `ShoveAction` + forced movement + targeting wiring | `ShoveAction`, `EntityManager.TryMoveEntityImmediate`, `TargetingMode.Shove`, `H` hotkey, scene/validator wiring, and EditMode forced-movement edge-case tests added |
| T-046 | P0 | done | Builder | Implement `GrappleAction` + AC impact for `Grabbed/Restrained` | `GrappleAction` added, `ConditionRules` treats `Grabbed/Restrained` as off-guard-like AC penalty, executor wiring and tests added, targeting mode/hotkey wiring completed |
| T-047 | P0 | done | Builder | Implement source-scoped grapple lifecycle + `EscapeAction` | `GrappleService`/`GrappleLifecycleController`, `EntityMovedEvent`, expiry-on-turn-end, release-on-move/combat-end, `EscapeAction` (best-of Athletics/Acrobatics, MAP), and targeting wiring/tests are implemented |
| T-048 | P0 | done | Builder | Implement Action Bar UI (`Phase 23`) with builder + validator support | `ActionBarController`, `TargetingController.OnModeChanged`, `ActionBarUIBuilder`, `SampleScene` action bar wiring, and EditMode tests for availability/highlights/listener safety are green |
| T-049 | P1 | done | Builder | Add world-space targeting feedback (eligible highlights + hover valid/invalid tint) | `TargetingFeedbackController`, `TargetingTintController`, hover events via `GridManager/GridInteraction`, and `TargetingController` preview validation path are implemented and covered by tests |
| T-050 | P1 | done | Builder | Add targeting reason hint UI (text prompts/reasons) with detailed preview reasons | `TargetingFailureReason`/`TargetingEvaluationResult`, `PreviewEntityDetailed`, `TargetingReasonFormatter`, `TargetingHintController`, ActionBar builder extension, scene/validator wiring, and tests completed |
| T-051 | P0 | done | Builder | Implement generic non-strike damage event foundation (`Phase 24`) | `DamageAppliedEvent`, `DamageApplicationService`, `Trip` crit damage routed through generic path, and `FloatingDamageUI` support for non-strike damage with regression tests |
| T-052 | P1 | done | Builder | Add generic damage combat-log forwarder + scene/validator wiring (`Phase 24.1`) | `DamageLogForwarder` logs `DamageAppliedEvent`, EditMode tests added, and `SampleScene` + validator/autofix wiring updated |
| T-053 | P0 | done | Builder | Implement `Phase 25` weapon-aware ranged Strike + bow MVP | Unified `Strike` path now supports melee/ranged weapons, ranged range-increment penalties are applied, strike targeting/preview UX is weapon-aware, `Shortbow` demo content is wired in `SampleScene`, and EditMode/PlayMode suites remain green |
| T-054 | P1 | done | Builder | Polish ranged Strike UX wording and add ranged boundary/log regressions (`Phase 25.1`) | Strike hint/reason text now uses `reach` vs `range` based on current weapon, ranged boundary tests cover first/max increment and unarmed fallback, and `StrikeLogForwarder` `RNG(...)` token coverage is explicit |
| T-055 | P1 | done | Builder | Add parameterized strike trait support for `Deadly`, `Fatal`, and `Volley` (`Phases 25.2–25.4`) | `Deadly`/`Fatal` crit math and `Volley` close-range penalty are implemented with typed weapon fields, strike payload/log breakdowns, and EditMode/PlayMode regressions green |
| T-056 | P0 | done | Builder | Implement `RepositionAction` core (`Phase 26`) with forced-movement path validation and tests | `RepositionAction`/`RepositionCheckContext` are implemented with Attack-trait MAP semantics, path-based destination validation (target stays within reach during movement), grapple-or-trait requirement path, deterministic crit-failure counter-reposition, and EditMode/PlayMode suites green |
| T-057 | P1 | done | Builder | Ship playable `Reposition` targeting UX and control polish (`Phases 26.1a–26.2`) | `TargetingController` now supports two-step `Reposition` state (`SelectTarget`/`SelectCell`) with cell highlights/hints, Action Bar + SampleScene/validator wiring is complete, `Esc` in cell phase means no move/action spent, and `V` hotkey toggles `Reposition` mode |
| T-058 | P0 | done | Builder | Implement ranged `Strike` LoS/cover MVP + polish (`Phase 27`) | `StrikeLineResolver` (grid supercover + permissive corner) is integrated into ranged `Strike` targeting/runtime; blocked lines return `NoLineOfSight`, cover applies AC bonus in payload/runtime/logs, and EditMode regressions cover resolver/phase/log/reason formatting |
| T-059 | P0 | done | Builder | Implement ranged `Strike` concealment MVP (`Phase 28a`) | Ranged strike now runs DC 5 concealment flat check for `Concealed` targets on would-hit (`Success/CritSuccess` vs AC), preserves `acDegree`, downgrades final strike `degree` to `Failure` on flat-check fail, and logs/payloads/tests cover the edge case |
| T-060 | P1 | done | Builder | Add concealed warning hints in strike preview (`Phase 28b`) | Targeting preview surfaces non-blocking concealment warning text for ranged strike risk states and tests cover hint formatting/selection behavior |
| T-061 | P1 | done | Builder | Polish ranged strike warning hints for combined risk states (`Phase 28c`) | Targeting hint UI now combines cover + concealment risk wording into a single coherent warning path with deterministic formatter/test coverage |
| T-062 | P0 | done | Builder | Implement Delay turn-flow MVP with lifecycle split (`Phases 29b–29c`) | `TurnManager` gained delay trigger window + delayed actor records + immediate delay effects hook + return-window state + reaction suppression gates, plus Action Bar Delay/Return/Skip controls and tests |
| T-063 | P1 | done | Builder | Implement Owlcat-style planned Delay insertion UX (`Phases 29d–29e`) | Delay now opens initiative insertion markers between portraits, supports planned anchor selection, auto-resumes delayed turns at the planned anchor, and suppresses manual Return/Skip for planned delays |
| T-064 | P1 | done | Verifier | Stabilize delay planned-anchor test assumptions | Delay test suite no longer relies on brittle ordering assumptions; deterministic anchors/order expectations are explicit |
| T-065 | P1 | done | Builder | Fix planned Delay multi-actor auto-chain sequencing | Multiple delayed player actors selecting the same planned anchor now resume sequentially in one chain without dropping turns |
| T-066 | P1 | done | Builder | Remove Delay UI polling and migrate to typed bus events (`Phase 29f`) | `ActionBarController` and `InitiativeBarController` now refresh Delay UI from typed `CombatEventBus` delay channels instead of per-frame polling |
| T-067 | P1 | done | Builder | Extract Delay placement prompt presenter (`Phase 29g.1`) | Delay prompt/banner creation and state updates moved into `DelayPlacementPromptPresenter` with safe runtime fallback refs |
| T-068 | P1 | done | Builder | Extract Delay insertion-marker overlay presenter (`Phase 29g.2`) | Marker pooling/repositioning/hover-click wiring moved into `DelayPlacementMarkerOverlayPresenter` with dirty-flag redraw path |
| T-069 | P1 | done | Builder | Extract Delay placement interaction coordinator (`Phase 29g.3`) | Marker click/hover orchestration and TurnManager Delay placement commits moved into `DelayPlacementInteractionCoordinator` |
| T-070 | P1 | done | Builder | Extract Delay initiative row planner (`Phase 29g.4`) | Delayed-slot grouping/ordering and marker eligibility rules moved into `DelayInitiativeRowPlanner` to reduce controller branching |
| T-071 | P1 | done | Builder | Final Initiative Bar Delay wiring cleanup (`Phase 29g.5`) | `InitiativeBarController` now delegates Delay-specific UI concerns to presenters/coordinator/planner with reduced mixed responsibilities |
| T-072 | P0 | done | Builder | Fix Reposition cell-select input and lock watchdog behavior | Reposition destination clicks no longer stall action execution; action-lock watchdog diagnostics remain as safety net without blocking success path |
| T-073 | P1 | done | Builder | Fix combat log wrapped-line clipping and pooled-line order | Combat log rows now use TMP preferred height per entry and pooled lines are reattached as last sibling, preventing visual freeze/clipping after heavy logs |
| T-074 | P1 | done | Builder | Add combat log retention notice and block camera zoom over UI | Combat log now explicitly shows retention cap text (`Showing last 80 lines`), and mouse-wheel zoom is ignored while pointer is over UI |
| T-075 | P1 | done | Builder | Block grid click-through when pointer is over UI | Grid hover/click processing now stops while pointer is over UI, preventing accidental movement/targeting from button clicks |
| T-076 | P1 | done | Builder | Fix GridInteraction pointer EventSystem compile break | `GridInteraction` now caches/uses the current `EventSystem` safely (no invalid `PointerEventData.eventSystem` usage) and PlayMode compile gate is clean |
| T-077 | P1 | done | Verifier | Add Delay orchestration PlayMode regressions (`Phase 29h`) | New PlayMode tests cover planned delay auto-resume without manual window, same-anchor multi-player auto-chain, manual delay `ReturnNow` resume, and manual delay `Skip` flow continuation |
| T-078 | P1 | done | Verifier | Add pointer-level Delay UI PlayMode regressions (`Phase 29i`) | New PlayMode tests validate UI pointer click path for Action Bar `Delay` toggle, initiative insertion marker commit, and `ReturnNow`/`Skip` button wiring in `DelayReturnWindow` |
| T-079 | P1 | done | Builder | Introduce top-level Delay UI orchestrator with safe fallback wiring (`Phase 29j`) | `DelayUiOrchestrator` now owns Delay typed-event fanout for `ActionBarController` + `InitiativeBarController` when present, while controllers keep internal event fallback for scenes/tests without explicit orchestrator wiring |
| T-080 | P1 | done | Builder | Add Delay UI orchestrator validator/autofix wiring (`Phase 29j.1`) | Scene validator now checks `DelayUiOrchestrator` refs and warns when missing in scenes that have both Action Bar and Initiative Bar; autofix creates/wires orchestrator automatically in that case |
| T-081 | P1 | done | Verifier | Add EditMode regression for validator auto-fix workflow guard (`Phase 29j.2`) | New EditMode test proves guard returns from clean non-sample scene to `SampleScene` after auto-fix workflow |
| T-082 | P1 | done | Verifier | Add `SampleScene` UI presence smoke regression | New EditMode smoke test verifies critical combat UI controllers exist in `SampleScene` (`ActionBar`, `InitiativeBar`, `TurnUI`, `CombatLog`) |
| T-083 | P1 | done | Verifier | Add EditMode regression for DelayUiOrchestrator auto-create/wiring (`Phase 29j.4`) | New EditMode test removes `DelayUiOrchestrator`, invokes validator `RunAutoFix(false)`, and verifies orchestrator is recreated with `eventBus`/`actionBarController`/`initiativeBarController` wired |
| T-084 | P1 | done | Verifier | Add EditMode idempotency regression for DelayUiOrchestrator autofix | New EditMode test verifies `RunAutoFix(false)` does not create duplicate `DelayUiOrchestrator` when one already exists |
| T-085 | P1 | done | Verifier | Add EditMode regression for DelayUiOrchestrator rewiring of broken existing instance | New EditMode test nulls orchestrator refs (`eventBus`/`actionBarController`/`initiativeBarController`), runs `RunAutoFix(false)`, and verifies refs are restored without creating duplicates |
| T-086 | P1 | done | Verifier | Add PlayMode regression for Delay full-round expiry semantics | New PlayMode test verifies manual delayed actor that repeatedly skips Return/Skip windows expires after one full round at original anchor (`DelayedTurnExpired`), is removed from delayed state, and gets reinserted turn without `DelayedTurnResumed` |
| T-087 | P1 | done | Verifier | Add pointer-flow PlayMode regression for Delay expiry skip windows | `DelayUiPointerPlayModeTests` now covers repeated `Skip` button pointer clicks across DelayReturnWindow cycles until delayed actor expires and is reinserted |
| T-088 | P0 | done | Builder | Refactor initiative to `CheckRoll` + Perception-based ordering and typed breakdown logs | Initiative now uses `CheckResolver.RollPerception` (`PerceptionModifier`), sorts by total with enemy-first tie policy, publishes deterministic payload/log breakdown (`d20 + source(mod) = total`), and EditMode/PlayMode regressions are green |
| T-089 | P1 | done | Builder | Start Phase 30b with generic opposed-check foundation (`RollOpposedCheck`) | Added `OpposedCheckResult` domain primitive, `CheckResolver.RollOpposedCheck(...)`, typed bus event `OpposedCheckResolvedEvent`, `OpposedCheckLogForwarder`, and EditMode coverage for resolver + log forwarding |
| T-090 | P1 | done | Builder | Migrate skill-check action payloads to `CheckRoll` + explicit defense source (`Phase 30c`) | `SkillCheckResolvedEvent` now carries `CheckRoll` and `defenseSource`; action publishers (`Trip/Shove/Grapple/Escape/Reposition/Demoralize`) send typed roll source + DC source; `SkillCheckLogForwarder` and tests updated |
| T-091 | P1 | done | Builder | Migrate strike payload/log breakdown to typed `CheckRoll`/source metadata (`Phase 30d`) | `StrikePhaseResult`/`StrikeResolvedEvent`/`StrikePreDamageEvent` now expose typed attack roll + defense source (and concealment roll when used), `StrikeAction` publishes pre-damage via typed roll overload, and strike log/tests validate new `ATK ... vs AC` contract |
| T-092 | P1 | done | Builder | Unify roll breakdown formatter across logs and targeting hints (`Phase 30e`) | Added shared `RollBreakdownFormatter`; migrated Skill/Opposed/Strike log forwarders to it; targeting valid-hint formulas now come from the same source-label formatter; EditMode/PlayMode green |
| T-093 | P1 | done | Builder | Consolidate strike attack-math and defense-with-cover formatting in shared formatter (`Phase 30f`) | `RollBreakdownFormatter` now owns strike attack token composition (`atk/MAP/RNG/VOLLEY`) and AC+cover formatting; `StrikeLogForwarder` no longer has local breakdown builder; new formatter tests cover optional token/cover behavior |
| T-094 | P1 | done | Builder | Remove remaining initiative-log formatter duplication (`Phase 30g`) | `TurnLogForwarder` now formats initiative lines through shared `RollBreakdownFormatter` (`rolls initiative: SRC d20(n) +/-m = total`) and local `FormatSigned` duplication is removed; EditMode/PlayMode green |
| T-095 | P1 | done | Builder | Add configurable initiative check mode with default Perception (`Phase 31a`) | `TurnManager` now supports initiative roll mode (`Perception` default, optional `Skill` source); `CheckResolver.RollSkill(...)` added; EditMode/PlayMode tests verify default Perception contract and skill-mode source/modifier payloads |
| T-096 | P1 | done | Builder | Wire encounter-level initiative source config through Start Encounter flow (`Phase 31b`) | `EncounterFlowController` now applies encounter-configured initiative mode/skill to `TurnManager` before `StartCombat`; preset supports the same fields; PlayMode verifies skill-mode start-button flow and default Perception authoring contract remains intact |
| T-097 | P1 | done | Builder | Support per-entity initiative skill override with Perception fallback (`Phase 31c`) | `EntityData` now supports authoring `UseInitiativeSkillOverride + InitiativeSkillOverride` (e.g. Avoiding Notice -> `Stealth`); `TurnManager` uses per-entity override first, then encounter/default source; mixed-source EditMode test and full PlayMode suite are green |
| T-098 | P1 | done | Builder | Add encounter authoring list for per-actor initiative overrides (`Phase 31d`) | `EncounterFlowController`/`EncounterFlowUIPreset` now support an authoring list (`actorName`, `useSkillOverride`, `skill`) applied on Start Encounter; non-listed actors reset to default Perception source; PlayMode covers Wizard stealth override path |

## Agent Prompt Contract (Copy/Paste)
1. Goal
2. Scope (allowed files/folders)
3. Non-goals
4. Definition of Done
5. Validation commands
6. Output format: Summary / Files changed / Risks / Next steps
